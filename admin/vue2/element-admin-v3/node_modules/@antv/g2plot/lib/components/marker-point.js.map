{"version":3,"file":"marker-point.js","sourceRoot":"","sources":["../../src/components/marker-point.ts"],"names":[],"mappings":"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","sourcesContent":["import { View, IGroup, IShape, MarkerSymbols } from '../dependents';\nimport { deepMix, isMatch, isString, isArray, each, find } from '@antv/util';\nimport { MappingDatum, GAnimateCfg } from '@antv/g2/lib/interface';\nimport { DEFAULT_ANIMATE_CFG } from '@antv/g2/lib/animate';\nimport { Event } from '@antv/g2/lib/dependents';\n\ninterface PointStyle {\n  size?: number;\n  fill?: string;\n  stroke?: string;\n  lineWidth?: number;\n}\n\ninterface MarkerItem {\n  _origin: object;\n}\n\ntype AnimationOption = {\n  endState: PointStyle;\n  animateCfg: GAnimateCfg;\n};\n\ninterface Cfg {\n  view: View;\n  data: any[];\n  // 'image://http://xxx.xxx.xxx/a/b.png'\n  symbol?: string | ((x: number, y: number, r: number) => any[][]);\n  size?: number;\n  /** 标注点 point 坐标的 x 偏移 */\n  offsetX?: number;\n  offsetY?: number;\n  label?: {\n    visible: boolean;\n    /** marker point 映射的字段 */\n    field?: string;\n    /** _origin: 原始数据 */\n    formatter?: (text: string, item: MarkerItem, index: number) => string;\n    position?: 'top' | 'bottom';\n    offsetX?: number;\n    offsetY?: number;\n    style?: object;\n  };\n  style?: {\n    normal?: PointStyle;\n    active?: PointStyle;\n    selected?: PointStyle;\n  };\n  events?: {\n    mouseenter?: (e: Event) => void;\n    mouseleave?: (e: Event) => void;\n    click?: (e: Event) => void;\n  };\n  animation?: boolean | AnimationOption;\n}\n\nconst DEFAULT_STYLE = {\n  stroke: 'transparent',\n  fill: '#FCC509',\n  lineWidth: 0,\n};\n\nconst ACTIVE_STYLE = {\n  stroke: '#FFF',\n  fill: '#FCC509',\n  lineWidth: 1,\n};\n\nconst SELECTED_STYLE = {\n  stroke: 'rgba(0,0,0,0.85)',\n  fill: '#FCC509',\n  lineWidth: 1,\n};\n\ninterface StateCondition {\n  id: string;\n  data: {};\n}\ntype State = 'active' | 'inactive' | 'selected';\n\nexport { Cfg as MarkerPointCfg };\n\n/**\n * 标注点 绘制在最顶层\n */\nexport default class MarkerPoint {\n  public view: View;\n  public container: IGroup;\n  public config: Cfg;\n  private points: IShape[] = [];\n  private labels: IShape[] = [];\n  private size: number;\n  private name = 'markerPoints';\n  private selectedPoint: IShape;\n\n  protected defaultCfg = {\n    offsetX: 0,\n    offsetY: 0,\n    style: { normal: DEFAULT_STYLE, selected: SELECTED_STYLE, active: ACTIVE_STYLE },\n    label: {\n      visible: false,\n      offsetY: -8,\n      position: 'top',\n      style: {\n        fill: 'rgba(0, 0, 0, 0.85)',\n      },\n    },\n    animation: false,\n  };\n\n  constructor(cfg: Cfg) {\n    this.view = cfg.view;\n    this.size = cfg.size || 6;\n    this.config = deepMix({}, this.defaultCfg, cfg);\n    this._init();\n  }\n\n  public render() {\n    const dataArray = this.getDataArray();\n    this._renderPoints(dataArray);\n    this.view.canvas.draw();\n    this._addInteraction();\n  }\n\n  public clear() {\n    if (this.container) {\n      this.container.clear();\n    }\n  }\n\n  public destroy() {\n    if (this.container) {\n      this.container.remove();\n    }\n    this.points = [];\n    this.labels = [];\n  }\n\n  protected getDataArray(): MappingDatum[][] {\n    const geometry = this.view.geometries[0];\n    return geometry.dataArray;\n  }\n\n  private _init() {\n    const layer = this.view.foregroundGroup;\n    this.container = layer.addGroup();\n    this.render();\n    this.view.on('beforerender', () => {\n      this.clear();\n    });\n  }\n\n  private _renderPoints(dataArray: MappingDatum[][]) {\n    each(this.config.data, (dataItem, dataItemIdx) => {\n      each(dataArray, (dataum: MappingDatum[]) => {\n        const origin = find(dataum, (d) => isMatch(d._origin, dataItem));\n        if (origin) {\n          const pointAttrs = this.config.style.normal;\n          const group = this.container.addGroup({ name: this.name });\n          let { x, y } = origin;\n          if (isArray(x)) {\n            x = x[0];\n          }\n          if (isArray(y)) {\n            y = y[0];\n          }\n          let symbol = this.config.symbol;\n          const { offsetX, offsetY } = this.config;\n          let point;\n          if (isString(symbol) && symbol.startsWith('image://')) {\n            const imageUrl = symbol.substr(8);\n            point = group.addShape('image', {\n              attrs: {\n                x: x - this.size / 2 + offsetX,\n                y: y - this.size / 2 + offsetY,\n                img: imageUrl,\n                width: this.size,\n                height: this.size,\n              },\n            });\n          } else {\n            symbol = isString(symbol) ? MarkerSymbols[symbol] : symbol;\n            point = group.addShape({\n              type: 'marker',\n              name: 'marker-point',\n              id: `point-${dataItemIdx}`,\n              attrs: {\n                x: x + offsetX,\n                y: y + offsetY,\n                r: this.size / 2,\n                ...pointAttrs,\n                symbol,\n              },\n            });\n          }\n          this.points.push(point);\n          this._animatePoint(point);\n          this._renderLabel(group, origin, dataItemIdx);\n          group.set('data', dataItem);\n          group.set('origin', origin);\n        }\n      });\n    });\n  }\n\n  private _renderLabel(container: IGroup, origin: MappingDatum, index) {\n    const { label: labelCfg } = this.config;\n    if (labelCfg && labelCfg.visible) {\n      const { offsetX = 0, offsetY = 0, formatter, position, field } = labelCfg;\n      let text = origin._origin[field];\n      if (formatter) {\n        text = formatter(text, { _origin: origin._origin }, index);\n      }\n      const x = isArray(origin.x) ? origin.x[0] : origin.x;\n      const y = isArray(origin.y) ? origin.y[0] : origin.y;\n      const label = container.addShape('text', {\n        name: 'marker-label',\n        id: `label-${index}`,\n        attrs: {\n          x: x + offsetX,\n          y: y + offsetY,\n          text: text || '',\n          ...labelCfg.style,\n          textAlign: 'center',\n          textBaseline: position === 'top' ? 'bottom' : 'top',\n        },\n      });\n      this.labels.push(label);\n    }\n  }\n\n  private _addInteraction() {\n    const { events } = this.config;\n    each(events, (cb, eventName) => {\n      this.container.on(`${this.name}:${eventName}`, (e) => {\n        cb(e);\n        const target = e.target.get('parent');\n        const pointShape = target.get('children')[0];\n        if (pointShape) {\n          const data = pointShape.get('data');\n          const id = pointShape.get('id');\n          const condition = { id, data };\n          if (eventName === 'click') {\n            if (this.selectedPoint && this.selectedPoint.get('id') === id) {\n              this.selectedPoint = null;\n              this.setState('inactive', condition);\n            } else {\n              this.selectedPoint = pointShape;\n              this.setState('selected', condition);\n            }\n          } else if (eventName === 'mouseenter') {\n            this.setState('active', condition);\n          } else if (eventName === 'mouseleave') {\n            this.setState('inactive', condition);\n          }\n        }\n        this.view.canvas.draw();\n      });\n      this.view.on('click', (e) => {\n        const target = e.target.get('parent');\n        if (!target || (target.get('name') !== this.name && this.selectedPoint)) {\n          this.selectedPoint = null;\n          this.setState('inactive');\n        }\n      });\n    });\n  }\n\n  private setState(state: State, condition?: StateCondition) {\n    if (state === 'active') {\n      if (!this.selectedPoint || condition.id !== this.selectedPoint.get('id')) {\n        this._onActive(condition);\n      }\n    } else if (state === 'inactive') {\n      this.points.forEach((p) => this._onInactive(p));\n    } else if (state === 'selected') {\n      this._onSelected(condition);\n    }\n  }\n\n  private _onActive(condition?: StateCondition) {\n    const { active } = this.config.style;\n    each(this.points, (point) => {\n      if (point.get('id') === condition.id) {\n        each(active, (v, k) => {\n          point.attr(k, v);\n        });\n      } else {\n        this._onInactive(point);\n      }\n    });\n  }\n\n  private _onInactive(point: IShape) {\n    const { normal } = this.config.style;\n    if (!this.selectedPoint || point.get('id') !== this.selectedPoint.get('id')) {\n      each(normal, (v, k) => {\n        point.attr(k, v);\n      });\n    }\n  }\n\n  private _onSelected(condition: StateCondition) {\n    const { selected } = this.config.style;\n    each(this.points, (point) => {\n      if (point.get('id') === condition.id) {\n        each(selected, (v, k) => {\n          point.attr(k, v);\n        });\n      } else {\n        this._onInactive(point);\n      }\n    });\n  }\n\n  /** point animation, not for label */\n  private _animatePoint(shape: IShape) {\n    const { animation, size } = this.config;\n    if (animation !== false) {\n      const { endState = {}, animateCfg = DEFAULT_ANIMATE_CFG.appear } = animation as AnimationOption;\n      shape.animate(\n        {\n          r: Number.isNaN(endState.size / 2) ? size / 2 : endState.size / 2,\n          ...endState,\n        },\n        animateCfg\n      );\n    }\n  }\n}\n"]}