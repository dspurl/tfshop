{"version":3,"file":"layer.js","sourceRoot":"","sources":["../../../src/plots/area/layer.ts"],"names":[],"mappings":"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","sourcesContent":["import { deepMix, has, each } from '@antv/util';\nimport { registerPlotType } from '../../base/global';\nimport { LayerConfig } from '../../base/layer';\nimport ViewLayer from '../../base/view-layer';\nimport { getGeom } from '../../geoms/factory';\nimport { ElementOption } from '../../interface/config';\nimport './component/label/area-point';\nimport './component/label/area-point-auto';\nimport { extractScale } from '../../util/scale';\nimport responsiveMethods from './apply-responsive';\nimport * as EventParser from './event';\nimport './theme';\nimport { getGeometryByType } from '../../util/view';\nimport { AreaViewConfig } from './interface';\nimport { Maybe } from '../../interface/types';\n\nconst GEOM_MAP = {\n  area: 'area',\n  line: 'line',\n  point: 'point',\n};\n\nexport interface AreaLayerConfig extends AreaViewConfig, LayerConfig {}\n\nexport default class AreaLayer<T extends AreaLayerConfig = AreaLayerConfig> extends ViewLayer<T> {\n  public static getDefaultOptions(): any {\n    return deepMix({}, super.getDefaultOptions(), {\n      smooth: false,\n      areaStyle: {\n        opacity: 0.25,\n      },\n      line: {\n        visible: true,\n        size: 2,\n        style: {\n          opacity: 1,\n          lineJoin: 'round',\n          lineCap: 'round',\n        },\n      },\n      point: {\n        visible: false,\n        size: 4,\n        shape: 'point',\n      },\n      label: {\n        visible: false,\n        type: 'point',\n      },\n      legend: {\n        visible: true,\n        position: 'top-left',\n        wordSpacing: 4,\n      },\n      tooltip: {\n        visible: true,\n        shared: true,\n        showCrosshairs: true,\n        crosshairs: {\n          type: 'x',\n        },\n        offset: 20,\n      },\n    });\n  }\n\n  public line: any;\n  public point: any;\n  public area: any;\n  public type: string = 'area';\n\n  public beforeInit() {\n    super.beforeInit();\n    /** 响应式图形 */\n    if (this.options.responsive && this.options.padding !== 'auto') {\n      this.applyResponsive('preRender');\n    }\n  }\n\n  public afterRender() {\n    this.renderLabel();\n    /** 响应式 */\n    if (this.options.responsive && this.options.padding !== 'auto') {\n      this.applyResponsive('afterRender');\n    }\n    super.afterRender();\n  }\n\n  protected geometryParser(dim, type) {\n    return GEOM_MAP[type];\n  }\n\n  protected scale() {\n    const props = this.options;\n    const scales = {};\n    /** 配置x-scale */\n    scales[props.xField] = {\n      type: 'cat',\n    };\n    if (has(props, 'xAxis')) {\n      extractScale(scales[props.xField], props.xAxis);\n    }\n    /** 配置y-scale */\n    scales[props.yField] = {};\n    if (has(props, 'yAxis')) {\n      extractScale(scales[props.yField], props.yAxis);\n    }\n    this.setConfig('scales', scales);\n    super.scale();\n  }\n\n  protected coord() {\n    return null;\n  }\n\n  protected addGeometry() {\n    const props: any = this.options;\n    const area = getGeom('area', 'main', {\n      plot: this,\n    });\n    this.area = area;\n\n    if (props.label) {\n      this.label();\n    }\n\n    if (props.tooltip && (props.tooltip.fields || props.tooltip.formatter)) {\n      this.geometryTooltip();\n    }\n\n    this.adjustArea(area);\n    this.setConfig('geometry', area);\n\n    this.addLine();\n\n    this.addPoint();\n  }\n\n  //eslint-disable-next-line @typescript-eslint/no-unused-vars\n  protected adjustArea(area: ElementOption) {\n    return;\n  }\n\n  //eslint-disable-next-line @typescript-eslint/no-unused-vars\n  protected adjustLine(line?: ElementOption) {\n    return;\n  }\n\n  //eslint-disable-next-line @typescript-eslint/no-unused-vars\n  protected adjustPoint(point?: ElementOption) {\n    return;\n  }\n\n  protected addLine() {\n    const props: any = this.options;\n    const lineConfig = deepMix({}, props.line);\n    if (lineConfig.visible) {\n      const line = getGeom('line', 'guide', {\n        type: 'line',\n        plot: this,\n        line: lineConfig,\n      });\n      this.adjustLine(line);\n      this.setConfig('geometry', line);\n      this.line = line;\n    }\n  }\n\n  protected addPoint() {\n    const props = this.options;\n    const pointConfig = deepMix({}, props.point);\n    if (pointConfig.visible) {\n      const point = getGeom('point', 'guide', {\n        plot: this,\n      });\n      this.adjustPoint(point);\n      this.setConfig('geometry', point);\n      this.point = point;\n    }\n  }\n\n  protected renderLabel() {\n    const { scales } = this.config;\n    const { label, yField } = this.options;\n    const scale = scales[yField];\n    if (label.visible) {\n      const geometry = getGeometryByType(this.view, 'area');\n      this.doRenderLabel(geometry, {\n        type: 'area-point',\n        formatter: scale.formatter && ((value: Maybe<string | number>) => scale.formatter(value)),\n        ...this.options.label,\n      });\n    }\n  }\n\n  protected animation() {\n    super.animation();\n    const props = this.options;\n    if (props.animation === false) {\n      // 关闭动画\n      this.area.animate = false;\n      if (this.line) this.line.animate = false;\n      if (this.point) this.point.animate = false;\n    }\n  }\n\n  protected label() {\n    return;\n  }\n\n  protected geometryTooltip() {\n    this.area.tooltip = {};\n    const tooltipOptions: any = this.options.tooltip;\n    if (tooltipOptions.fields) {\n      this.area.tooltip.fields = tooltipOptions.fields;\n    }\n    if (tooltipOptions.formatter) {\n      this.area.tooltip.callback = tooltipOptions.formatter;\n      if (!tooltipOptions.fields) {\n        this.area.tooltip.fields = [this.options.xField, this.options.yField];\n        if (this.options.seriesField) {\n          this.area.tooltip.fields.push(this.options.seriesField);\n        }\n      }\n    }\n  }\n\n  protected parseEvents() {\n    super.parseEvents(EventParser);\n  }\n\n  private applyResponsive(stage) {\n    const methods = responsiveMethods[stage];\n    each(methods, (r) => {\n      const responsive = r as any;\n      responsive.method(this);\n    });\n  }\n}\n\nregisterPlotType('area', AreaLayer);\n"]}