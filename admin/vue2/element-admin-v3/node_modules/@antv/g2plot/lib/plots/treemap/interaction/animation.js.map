{"version":3,"file":"animation.js","sourceRoot":"","sources":["../../../../src/plots/treemap/interaction/animation.ts"],"names":[],"mappings":"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","sourcesContent":["import { each, clone, deepMix } from '@antv/util';\nimport { groupTransform, transform } from '../../../util/g-util';\n\nconst ulMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\nconst duration = 400;\nconst easing = 'easeQuadInOut';\n\nexport function drillingDown(target, view, callback) {\n  const rect = getRect(target);\n  const range = getRange(view);\n  const xRatio = range.width / rect.width;\n  const yRatio = range.height / rect.height;\n  const offsetX = (range.minX - rect.minX) * xRatio;\n  const offsetY = (range.minY - rect.minY) * yRatio;\n\n  const transformMatrix = transform([\n    ['s', xRatio, yRatio],\n    ['t', offsetX, offsetY],\n  ]);\n\n  let geometry = view.geometries[0];\n  hideLabel(geometry);\n  const tem_container = view.backgroundGroup.addGroup();\n  tem_container.set('zIndex', -100);\n  tem_container.setClip({\n    type: 'rect',\n    attrs: {\n      x: range.minX,\n      y: range.minY,\n      width: range.width,\n      height: range.height,\n    },\n  });\n  const tem_shapes = getTemShapes(geometry, tem_container);\n  geometry.container.set('visible', false);\n  view.canvas.draw();\n  callback();\n  window.setTimeout(() => {\n    each(tem_shapes, (shape, index) => {\n      if (index === 0) {\n        shape.animate({ matrix: transformMatrix }, duration, easing, () => {\n          tem_container.remove();\n          view.canvas.draw();\n        });\n      } else {\n        shape.animate(transform, duration);\n      }\n    });\n    geometry = view.geometries[0];\n    hideLabel(geometry);\n    const shapes = geometry.getShapes();\n    each(shapes, (shape) => {\n      shape.attr('opacity', 0);\n      shape.animate(\n        {\n          opacity: 1,\n        },\n        duration,\n        easing\n      );\n    });\n    const container = geometry.container;\n    container.stopAnimate();\n    container.set('visible', true);\n    container.attr('matrix', clone(ulMatrix));\n    groupTransform(container, [\n      ['s', rect.width / range.width, rect.height / range.height],\n      ['t', rect.minX, rect.minY],\n    ]);\n    const matrix = clone(ulMatrix);\n    geometry.container.animate(\n      {\n        matrix,\n      },\n      duration,\n      easing,\n      () => {\n        showLabel(geometry);\n      }\n    );\n    view.canvas.draw();\n  }, 16);\n}\n\nfunction getTemShapes(geometry, container) {\n  const shapes = geometry.getShapes();\n  const tem_shapes = [];\n  each(shapes, (shape) => {\n    const s = container.addShape('path', {\n      attrs: deepMix({}, shape.attrs, { capture: false }),\n    });\n    tem_shapes.push(s);\n  });\n  return tem_shapes;\n}\n\nexport function rollingUp(name, view, callback) {\n  let geometry = view.geometries[0];\n  hideLabel(geometry);\n  let container = geometry.container;\n  container.attr('matrix', clone(ulMatrix));\n  const tem_container = view.backgroundGroup.addGroup();\n  tem_container.set('zIndex', -100);\n  const tem_shapes = getTemShapes(geometry, tem_container);\n  container.set('visible', false);\n  view.canvas.draw();\n  callback();\n  geometry = view.geometries[0];\n  hideLabel(geometry);\n  container = geometry.container;\n  const shape = findShapeByName(geometry.getShapes(), name); //根据name获得上一级shape\n  const rect = getRect(shape);\n  const range = getRange(view);\n  const containerParent = container.get('parent');\n  if (!containerParent.get('clipShape')) {\n    container.setClip({\n      type: 'rect',\n      attrs: {\n        x: range.minX,\n        y: range.minY,\n        width: range.width,\n        height: range.height,\n      },\n    });\n  }\n  shrinkTemp(tem_container, tem_shapes, rect, range);\n  const xRatio = range.width / rect.width;\n  const yRatio = range.height / rect.height;\n  const offsetX = (range.minX - rect.minX) * xRatio;\n  const offsetY = (range.minY - rect.minY) * yRatio;\n  const transformMatrix = transform([\n    ['s', xRatio, yRatio],\n    ['t', offsetX, offsetY],\n  ]);\n  container.setMatrix(transformMatrix);\n  container.set('visible', true);\n  container.animate(\n    {\n      matrix: ulMatrix,\n    },\n    duration,\n    easing,\n    () => {\n      showLabel(geometry);\n    }\n  );\n}\n\nfunction findShapeByName(shapes, n) {\n  let shape;\n  each(shapes, (s) => {\n    const { name } = s.get('origin').data;\n    if (name === n) {\n      shape = s;\n    }\n  });\n  return shape;\n}\n\nfunction getRange(view) {\n  const viewRange = view.coordinateBBox;\n  const range = {\n    minX: viewRange.minX,\n    minY: viewRange.minY,\n    centerX: (viewRange.maxX - viewRange.minX) / 2,\n    centerY: (viewRange.maxY - viewRange.minY) / 2,\n    width: viewRange.width,\n    height: viewRange.height,\n  };\n  return range;\n}\n\nfunction getRect(shape) {\n  const path = shape.attr('path');\n  const x0 = path[0][1];\n  const y1 = path[0][2];\n  const x1 = path[1][1];\n  const y0 = path[2][2];\n  const rect = {\n    minX: x0,\n    minY: y0,\n    centerX: (x1 - x0) / 2,\n    centerY: (y1 - y0) / 2,\n    width: Math.abs(x1 - x0),\n    height: Math.abs(y1 - y0),\n  };\n  return rect;\n}\n\nfunction shrinkTemp(container, shapes, rect, range) {\n  const xRatio = rect.width / range.width;\n  const yRatio = rect.height / range.height;\n  const transformMatrix = transform([\n    ['s', xRatio, yRatio],\n    ['t', rect.minX, rect.minY],\n  ]);\n  container.animate({ matrix: transformMatrix }, duration, easing, () => {\n    container.remove();\n  });\n  each(shapes, (shape) => {\n    shape.animate(\n      {\n        opacity: 0,\n      },\n      duration,\n      easing\n    );\n  });\n}\n\nfunction hideLabel(geometry) {\n  const labelContainer = geometry.labelsContainer;\n  labelContainer.set('visible', false);\n}\n\nfunction showLabel(geometry) {\n  const labelContainer = geometry.labelsContainer;\n  labelContainer.set('visible', true);\n}\n"]}