{"version":3,"file":"bulletTarget.js","sourceRoot":"","sources":["../../../../src/plots/bullet/component/bulletTarget.ts"],"names":[],"mappings":"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","sourcesContent":["import BBox from '../../../util/bbox';\nimport { View, Geometry, IGroup } from '../../../dependents';\nimport { find, map } from '@antv/util';\n\nexport interface BulletTargetCfg {\n  targets: number[][];\n  markerSize: number;\n  yField: string;\n  markerColors: string[];\n  markerStyle?: {\n    fill?: string;\n    stroke?: string;\n    strokeOpacity?: number;\n    [k: string]: any;\n  };\n}\n\nexport default class BulletTarget {\n  private view: View;\n  private container: IGroup;\n  private cfg: BulletTargetCfg;\n\n  constructor(view: View, cfg: BulletTargetCfg) {\n    this.view = view;\n    this.cfg = cfg;\n    this._init();\n  }\n\n  /** 绘制辅助labels */\n  public draw() {\n    if (!this.view || this.view.destroyed) {\n      return;\n    }\n    this.container = this.view.foregroundGroup.addGroup();\n    this.container.set('name', 'targetGroups');\n    const shapes = map(this.getGeometry().elements, (element: any) => element.shape);\n    for (let i = 0; i < this.cfg.targets.length; i += 1) {\n      const shapeBox = shapes[i].getBBox();\n      const widthRatio = shapeBox.width / shapes[i].get('origin').data[this.cfg.yField];\n      this.drawTarget(shapeBox, this.cfg.targets[i], widthRatio);\n    }\n    this.view.canvas.draw();\n  }\n\n  protected drawTarget(box: BBox, targets: number[], widthRatio: number) {\n    const options = this.cfg;\n    const colors = options.markerColors;\n    /** 添加目标值 */\n    targets.forEach((target: number, i) => {\n      const markerStyle = options.markerStyle;\n      this.container.addShape('rect', {\n        name: 'bullet-target',\n        attrs: {\n          width: markerStyle.width,\n          height: box.height * options.markerSize - markerStyle.width / 2,\n          x: box.minX + target * widthRatio,\n          y: box.minY - (box.height * (options.markerSize - 1)) / 2,\n          ...markerStyle,\n          fill: colors[i % colors.length] || markerStyle.fill,\n        },\n      });\n    });\n  }\n\n  public clear() {\n    if (this.container) {\n      this.container.clear();\n    }\n  }\n\n  public destroy() {\n    if (this.container) {\n      this.container.remove();\n    }\n  }\n\n  private _init() {\n    this.view.on('beforerender', () => {\n      this.clear();\n    });\n\n    this.view.on('afterrender', () => {\n      this.draw();\n    });\n  }\n\n  private getGeometry() {\n    return find(this.view.geometries, (geometry) => geometry.type === 'interval') as Geometry;\n  }\n}\n"]}