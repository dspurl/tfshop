{"version":3,"file":"layer.js","sourceRoot":"","sources":["../../../src/plots/grouped-bar/layer.ts"],"names":[],"mappings":"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","sourcesContent":["import { deepMix, valuesOfKey, sortBy } from '@antv/util';\nimport { registerPlotType } from '../../base/global';\nimport { LayerConfig } from '../../base/layer';\nimport { ElementOption } from '../../interface/config';\nimport BaseBarLayer from '../bar/layer';\nimport { BarViewConfig } from '../bar/interface';\nimport './theme';\n\nexport interface GroupedBarViewConfig extends BarViewConfig {\n  groupField: string;\n}\n\nexport interface GroupedBarLayerConfig extends GroupedBarViewConfig, LayerConfig {}\n\nexport default class GroupedBarLayer extends BaseBarLayer<GroupedBarLayerConfig> {\n  public static getDefaultOptions(): Partial<GroupedBarViewConfig> {\n    return deepMix({}, super.getDefaultOptions(), {\n      xAxis: {\n        visible: true,\n        grid: {\n          visible: true,\n        },\n      },\n      yAxis: {\n        visible: true,\n        title: {\n          visible: false,\n        },\n      },\n      label: {\n        visible: true,\n        position: 'right',\n        adjustColor: true,\n      },\n      legend: {\n        visible: true,\n        position: 'right-top',\n        offsetY: 0,\n      },\n    });\n  }\n\n  public type: string = 'groupedBar';\n\n  public baseType: string = 'bar';\n\n  public afterRender() {\n    super.afterRender();\n    const names = valuesOfKey(this.options.data, this.options.groupField) || [];\n    this.view.on('tooltip:change', (e) => {\n      const { items = [] } = e;\n      const fixedItems = sortBy(items.slice(), (item) => {\n        return names.indexOf(item.name);\n      }).reverse();\n      fixedItems.forEach((item, idx) => {\n        e.items[idx] = item;\n      });\n    });\n  }\n\n  public getColorScale() {\n    const { groupField } = this.options;\n    if (groupField) {\n      return this.view.getScaleByField(groupField);\n    }\n  }\n\n  protected scale() {\n    const defaultMeta = {};\n    defaultMeta[this.options.groupField] = {\n      values: valuesOfKey(this.options.data, this.options.groupField),\n    };\n    if (!this.options.meta) {\n      this.options.meta = defaultMeta;\n    } else {\n      this.options.meta = deepMix({}, this.options.meta, defaultMeta);\n    }\n    super.scale();\n  }\n\n  protected adjustBar(bar: ElementOption) {\n    bar.adjust = [\n      {\n        type: 'dodge',\n        marginRatio: 0.1,\n      },\n    ];\n  }\n\n  protected geometryTooltip() {\n    this.bar.tooltip = {};\n    const tooltipOptions: any = this.options.tooltip;\n    if (tooltipOptions.fields) {\n      this.bar.tooltip.fields = tooltipOptions.fields;\n    }\n    if (tooltipOptions.formatter) {\n      this.bar.tooltip.callback = tooltipOptions.formatter;\n      if (!tooltipOptions.fields) {\n        this.bar.tooltip.fields = [this.options.xField, this.options.yField, this.options.groupField];\n      }\n    }\n  }\n}\n\nregisterPlotType('groupedBar', GroupedBarLayer);\n"]}