{"version":3,"file":"label.js","sourceRoot":"","sources":["../../../../src/plots/range-column/component/label.ts"],"names":[],"mappings":"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","sourcesContent":["import { each, deepMix, clone, find } from '@antv/util';\nimport { View, IGroup, Geometry } from '../../../dependents';\nimport { rgb2arr } from '../../../util/color';\nimport BBox from '../../../util/bbox';\n\nconst DEFAULT_OFFSET = 8;\n\nfunction mappingColor(band, gray) {\n  let reflect;\n  each(band, (b) => {\n    const map = b;\n    if (gray >= map.from && gray < map.to) {\n      reflect = map.color;\n    }\n  });\n  return reflect;\n}\n\nexport interface RangeColumnLabelConfig {\n  visible: boolean;\n  position?: 'outer' | 'inner';\n  formatter?: (...args: any[]) => string;\n  offsetX?: number;\n  offsetY?: number;\n  style?: any;\n  topStyle?: any;\n  bottomStyle?: any;\n  adjustColor?: boolean;\n  adjustPosition?: boolean;\n}\n\nexport interface IRangeColumnLabel extends RangeColumnLabelConfig {\n  view: View;\n  plot: any;\n}\n\nexport default class RangeColumnLabel {\n  public options: RangeColumnLabelConfig;\n  public destroyed: boolean = false;\n  private plot: any;\n  private view: View;\n  private coord: any;\n  private container: IGroup;\n\n  constructor(cfg: IRangeColumnLabel) {\n    this.view = cfg.view;\n    this.plot = cfg.plot;\n    const defaultOptions = this.getDefaultOptions();\n    this.options = deepMix(defaultOptions, cfg, {});\n    if (!this.options.topStyle) {\n      this.options.topStyle = this.options.style;\n    }\n    if (!this.options.bottomStyle) {\n      this.options.bottomStyle = this.options.style;\n    }\n    this.init();\n  }\n\n  public init() {\n    this.container = this.getGeometry().labelsContainer;\n    this.view.on('beforerender', () => {\n      this.clear();\n      this.plot.canvas.draw();\n    });\n  }\n\n  public render() {\n    const { coordinate, elements } = this.getGeometry();\n    this.coord = coordinate;\n    each(elements, (ele) => {\n      const shape = ele.shape;\n      const positions = this.getPosition(shape);\n      const values = this.getValue(shape);\n      const textBaeline = this.getTextBaseline();\n      const labels = [];\n      each(positions, (pos, i) => {\n        const style = i === 1 ? this.options.topStyle : this.options.bottomStyle;\n        const color = this.getTextColor(shape, i);\n        if (this.options.position === 'inner' && this.options.adjustColor && color !== 'black') {\n          style.stroke = null;\n        }\n        const formatter = this.options.formatter;\n        const content = formatter ? formatter(values[i]) : values[i];\n        const label = this.container.addShape('text', {\n          attrs: deepMix({}, style, {\n            x: pos.x,\n            y: pos.y,\n            text: content,\n            fill: color,\n            textAlign: 'center',\n            textBaseline: textBaeline[i],\n          }),\n          name: 'label',\n        });\n        labels.push(label);\n        this.doAnimation(label);\n      });\n      shape.set('labelShapes', labels);\n      this.adjustPosition(labels[0], labels[1], shape);\n    });\n    this.plot.canvas.draw();\n  }\n\n  public hide() {\n    this.container.set('visible', false);\n    this.plot.canvas.draw();\n  }\n\n  public show() {\n    this.container.set('visible', true);\n    this.plot.canvas.draw();\n  }\n\n  public clear() {\n    if (this.container) {\n      this.container.clear();\n    }\n  }\n\n  public destroy() {\n    if (this.container) {\n      this.container.remove();\n    }\n    this.destroyed = true;\n  }\n\n  public getBBox() {\n    return this.container.getBBox();\n  }\n\n  protected getShapeBbox(shape) {\n    const points = [];\n    each(shape.get('origin').points, (p) => {\n      points.push(this.coord.convertPoint(p));\n    });\n    const bbox = new BBox(\n      points[0].x,\n      points[1].y,\n      Math.abs(points[2].x - points[0].x),\n      Math.abs(points[0].y - points[1].y)\n    );\n    return bbox;\n  }\n\n  private getDefaultOptions() {\n    const { theme } = this.plot;\n    const labelStyle = theme.label.style;\n    return {\n      position: 'outer',\n      offsetX: 0,\n      offsetY: DEFAULT_OFFSET,\n      style: clone(labelStyle),\n      adjustColor: true,\n      adjustPosition: true,\n    };\n  }\n\n  private getPosition(shape) {\n    const bbox = this.getShapeBbox(shape);\n    const { minX, minY, maxY, width } = bbox;\n    const { offsetY } = this.options;\n    const x = minX + width / 2;\n    let y1, y2;\n    if (this.options.position === 'outer') {\n      y1 = minY - offsetY;\n      y2 = maxY + offsetY;\n    } else {\n      y1 = minY + offsetY;\n      y2 = maxY - offsetY;\n    }\n    return [\n      { x: x, y: y2 },\n      { x: x, y: y1 },\n    ];\n  }\n\n  private getValue(shape) {\n    const { yField } = this.plot.options;\n    return shape.get('origin').data[yField];\n  }\n\n  private getTextBaseline() {\n    if (this.options.position === 'outer') {\n      return ['top', 'bottom'];\n    } else {\n      return ['bottom', 'top'];\n    }\n  }\n\n  private getTextColor(shape, index) {\n    if (this.options.adjustColor && this.options.position === 'inner') {\n      const shapeColor = shape.attr('fill');\n      const shapeOpacity = shape.attr('opacity') ? shape.attr('opacity') : 1;\n      const rgb = rgb2arr(shapeColor);\n      const gray = Math.round(rgb[0] * 0.299 + rgb[1] * 0.587 + rgb[2] * 0.114) / shapeOpacity;\n      const colorBand = [\n        { from: 0, to: 85, color: 'white' },\n        { from: 85, to: 170, color: '#F6F6F6' },\n        { from: 170, to: 255, color: 'black' },\n      ];\n      const reflect = mappingColor(colorBand, gray);\n      return reflect;\n    }\n    const defaultColor = index === 1 ? this.options.topStyle.fill : this.options.bottomStyle.fill;\n    return defaultColor;\n  }\n\n  private doAnimation(label) {\n    if (this.plot.animation && this.plot.animation === false) {\n      return;\n    }\n    label.attr('fillOpacity', 0);\n    label.attr('strokeOpacity', 0);\n    label.stopAnimate();\n    label.animate(\n      {\n        fillOpacity: 1,\n        strokeOpacity: 1,\n      },\n      800,\n      'easeLinear',\n      500\n    );\n  }\n\n  private adjustPosition(la, lb, shape) {\n    const origin = shape.get('origin');\n    const shapeMinY = origin.y[1];\n    const shapeMaxY = origin.y[0];\n    const bbox = shape.getBBox();\n    const { height } = bbox;\n    const shapeHeight = height;\n    const panelRange = this.view.coordinateBBox;\n    const boxes = [la.getBBox(), lb.getBBox()];\n    let ay = la.attr('y');\n    let by = lb.attr('y');\n    if (this.options.adjustPosition && this.options.position === 'inner') {\n      const totalLength = boxes[0].height + boxes[1].height;\n      const isOverlap = boxes[1].maxY - boxes[0].minY > 2;\n      const isTooShort = totalLength > shapeHeight;\n      if (isOverlap || isTooShort) {\n        by = shapeMinY - this.options.offsetY;\n        lb.attr('fill', this.options.topStyle.fill);\n        lb.attr('textBaseline', 'bottom');\n        ay = shapeMaxY + this.options.offsetY;\n        la.attr('fill', this.options.bottomStyle.fill);\n        la.attr('textBaseline', 'top');\n        boxes[0] = la.getBBox();\n        boxes[1] = lb.getBBox();\n      }\n    }\n    // fixme: textBaseline 取不准bbox\n    if (boxes[0].maxY > panelRange.maxY - DEFAULT_OFFSET) {\n      ay = panelRange.maxY - DEFAULT_OFFSET / 2;\n      la.attr('textBaseline', 'bottom');\n    }\n    la.attr('y', ay);\n    lb.attr('y', by);\n    this.plot.canvas.draw();\n  }\n\n  private getGeometry() {\n    return find(this.view.geometries, (geom) => geom.type === 'interval') as Geometry;\n  }\n}\n"]}