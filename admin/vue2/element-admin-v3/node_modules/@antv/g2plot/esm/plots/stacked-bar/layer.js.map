{"version":3,"file":"layer.js","sourceRoot":"","sources":["../../../src/plots/stacked-bar/layer.ts"],"names":[],"mappings":"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","sourcesContent":["import { deepMix } from '@antv/util';\nimport { registerPlotType } from '../../base/global';\nimport { LayerConfig } from '../../base/layer';\nimport { ElementOption } from '../../interface/config';\nimport BaseBarLayer from '../bar/layer';\nimport { BarViewConfig } from '../bar/interface';\nimport './theme';\nimport './component/label';\nimport './component/label-auto';\nimport { getGeometryByType } from '../../util/view';\nimport { Maybe } from '../../interface/types';\n\nexport interface StackedBarViewConfig extends BarViewConfig {\n  stackField: string;\n}\n\nexport interface StackedBarLayerConfig extends StackedBarViewConfig, LayerConfig {}\n\nexport default class StackedBarLayer<T extends StackedBarLayerConfig = StackedBarLayerConfig> extends BaseBarLayer<T> {\n  public static getDefaultOptions() {\n    return deepMix({}, super.getDefaultOptions(), {\n      xAxis: {\n        visible: true,\n        autoRotateTitle: false,\n        grid: {\n          visible: true,\n        },\n        line: {\n          visible: false,\n        },\n        tickLine: {\n          visible: true,\n        },\n        label: {\n          visible: true,\n          autoRotate: true,\n          autoHide: true,\n        },\n        title: {\n          visible: true,\n          spacing: 12,\n        },\n      },\n      yAxis: {\n        visible: true,\n        autoRotateTitle: true,\n        grid: {\n          visible: false,\n        },\n        line: {\n          visible: false,\n        },\n        tickLine: {\n          visible: false,\n        },\n        label: {\n          visible: true,\n          autoRotate: true,\n          autoHide: true,\n        },\n        title: {\n          visible: false,\n          spacing: 12,\n        },\n      },\n      legend: {\n        visible: true,\n        position: 'top-left',\n        offsetY: 0,\n      },\n    });\n  }\n\n  public type: string = 'stackedBar';\n  public baseType: string = 'bar';\n\n  public getColorScale() {\n    const { stackField } = this.options;\n    return this.view.getScaleByField(stackField);\n  }\n\n  protected adjustBar(bar: ElementOption) {\n    bar.adjust = [\n      {\n        type: 'stack',\n      },\n    ];\n  }\n\n  protected renderLabel() {\n    const { scales } = this.config;\n    const { label, xField } = this.options;\n    const scale = scales[xField];\n    if (label?.visible) {\n      const geometry = getGeometryByType(this.view, 'interval');\n      this.doRenderLabel(geometry, {\n        type: 'stacked-bar',\n        formatter: scale.formatter && ((value: Maybe<string | number>) => scale.formatter(value)),\n        ...this.options.label,\n      });\n    }\n  }\n\n  protected geometryTooltip() {\n    this.bar.tooltip = {};\n    const tooltipOptions: any = this.options.tooltip;\n    if (tooltipOptions.fields) {\n      this.bar.tooltip.fields = tooltipOptions.fields;\n    }\n    if (tooltipOptions.formatter) {\n      this.bar.tooltip.callback = tooltipOptions.formatter;\n      if (!tooltipOptions.fields) {\n        this.bar.tooltip.fields = [this.options.xField, this.options.yField, this.options.stackField];\n      }\n    }\n  }\n}\n\nregisterPlotType('stackedBar', StackedBarLayer);\n"]}