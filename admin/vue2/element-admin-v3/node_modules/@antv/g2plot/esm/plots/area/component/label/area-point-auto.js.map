{"version":3,"file":"area-point-auto.js","sourceRoot":"","sources":["../../../../../src/plots/area/component/label/area-point-auto.ts"],"names":[],"mappings":"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","sourcesContent":["import { each, map, filter, last } from '@antv/util';\nimport { registerLabelComponent } from '../../../../components/label/base';\nimport PointAutoLabel from '../../../../components/label/point-auto';\nimport { Geometry, IShape, IElement } from '../../../../dependents';\nimport { getGeometryShapes, getGeometryByType } from '../../../../util/view';\nimport { getStrokePoints } from '../../../../util/math';\nimport { isContrastColorWhite } from '../../../../util/color';\nimport { IAreaPointAutoLabel } from '../../interface';\n\nexport default class AreaPointAutoLabel extends PointAutoLabel<IAreaPointAutoLabel> {\n  protected layoutLabels(geometry: Geometry, labels: IShape[]) {\n    super.layoutLabels(geometry, labels);\n    this.adjustAreaLabelsStyle(labels);\n  }\n\n  protected adjustAreaLabelsStyle(labels: IShape[]) {\n    const { view } = this;\n    const { darkStyle, lightStyle } = this.options;\n    const areaGeometry = getGeometryByType(view, 'area');\n    const areas = getGeometryShapes(areaGeometry).sort((left: IElement, right: IElement) => {\n      return right.getBBox().height - left.getBBox().height;\n    }) as IShape[];\n\n    each(labels, (label: IShape) => {\n      const labelBBox = label.getBBox();\n      const points = getStrokePoints(labelBBox.x, labelBBox.y, labelBBox.width, labelBBox.height);\n      const match = map(areas, (area) => ({\n        area,\n        matches: filter(points, (point) => !!area.isHit(point[0], point[1])).length,\n      })).sort((left, right) => left.matches - right.matches);\n      if (last(match).matches > 0) {\n        const bgColor = last(match).area.attr('fill');\n        const fillWhite = isContrastColorWhite(bgColor);\n        label.attr({\n          fill: fillWhite ? lightStyle?.fill : darkStyle?.fill,\n          fillOpacity: fillWhite ? lightStyle.fillOpacity : darkStyle.fillOpacity,\n          stroke: fillWhite ? lightStyle?.stroke : darkStyle?.stroke,\n        });\n      }\n    });\n  }\n}\n\nregisterLabelComponent('area-point-auto', AreaPointAutoLabel);\n"]}