{"version":3,"file":"drillDown.js","sourceRoot":"","sources":["../../../../src/plots/treemap/interaction/drillDown.ts"],"names":[],"mappings":"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","sourcesContent":["import Breadcrumb from '../../../components/breadcrumb';\nimport BaseInteraction from '../../../interaction/base';\nimport { IGroup } from '@antv/g-base';\nimport BBox from '../../../util/bbox';\nimport TreemapLayer from '../layer';\nimport { each, hasKey, isFunction, clone } from '@antv/util';\nimport { drillingDown, rollingUp } from './animation';\n\nconst DEFAULT_ITEM_WIDTH = 100;\nconst DEFAULT_ITEM_HEIGHT = 30;\nconst PADDING_TOP = 10;\n\ninterface IStartNode {\n  name?: string;\n}\n\ninterface IMapping {\n  [key: string]: IMappingConfig;\n}\n\ninterface IMappingConfig {\n  field: string;\n  values?: string[] | Function;\n}\n\ninterface IDrillDownInteractionConfig {\n  x?: number;\n  y?: number;\n  startNode?: IStartNode;\n  itemWidth?: number;\n  itemHeight?: number;\n  padding?: number[];\n}\n\nexport type IDrillDown = {\n  mapping?: {\n    [key: string]: IMappingConfig;\n  };\n};\n\nconst getValidBreadcrumbConfig = (cfg: IDrillDownInteractionConfig = {}): Required<IDrillDownInteractionConfig> => {\n  const _cfg: Required<IDrillDownInteractionConfig> = {\n    x: 0,\n    y: 0,\n    startNode: { name: 'root' },\n    itemWidth: DEFAULT_ITEM_WIDTH,\n    itemHeight: DEFAULT_ITEM_HEIGHT,\n    padding: [0, 0, 0, 0],\n    ...cfg,\n  };\n  return _cfg;\n};\n\nexport default class DrillDownInteraction extends BaseInteraction {\n  public static getInteractionRange(layerRange: BBox, interaction: IDrillDownInteractionConfig) {\n    const config: Required<IDrillDownInteractionConfig> = getValidBreadcrumbConfig(interaction);\n    const [paddingTop, paddingBottom] = config.padding;\n    if (layerRange) {\n      return new BBox(\n        layerRange.minX,\n        layerRange.maxY - config.itemHeight - paddingTop - paddingBottom,\n        layerRange.width,\n        config.itemHeight + paddingTop + paddingBottom\n      );\n    }\n  }\n\n  private container: IGroup;\n  private breadcrumb: Breadcrumb;\n  private plot: TreemapLayer;\n  private startNode: IStartNode;\n  private parentNode: any;\n  private currentNode: any;\n  private currentDepth: number;\n  private startNodeName: string;\n  private cache: any;\n  private mapping: IMapping;\n  private originMapping: IMappingConfig;\n  private y: number;\n  private geometry: any;\n\n  public start(ev) {\n    const data = ev.data.data;\n    if (data.children) {\n      this.parentNode = {\n        color: ev.target.attr('fill'),\n        shape: ev.target,\n        data: {\n          name: clone(this.currentNode.name),\n          value: clone(this.currentNode.value),\n        },\n        depth: clone(this.currentDepth),\n      };\n      this.currentDepth++;\n      drillingDown(ev.target, this.view, () => {\n        this.update(data);\n      });\n    }\n  }\n\n  protected update(data) {\n    if (!hasKey(this.cache, data.name)) {\n      this.cache[data.name] = data;\n    }\n    const tempoData = this.plot.getTreemapData(data, data.depth);\n    this.view.changeData(tempoData);\n    this.adjustScale(this.currentDepth);\n    this.currentNode = data;\n    this.render();\n  }\n\n  public render() {\n    if (this.breadcrumb) {\n      const items = this.getItems();\n      this.breadcrumb.update({\n        items,\n      });\n      this.breadcrumb.render();\n      this.layout();\n    } else {\n      this.initGeometry();\n      this.cache = {};\n      this.saveOriginMapping();\n      this.container = this.plot.canvas.addGroup();\n      if (!this.startNode) {\n        this.startNode = {\n          name: 'root',\n        };\n      }\n      if (this.startNode.name === 'root') {\n        this.startNodeName = hasKey(this.plot.options.data, 'name') ? this.plot.options.data.name : 'root';\n        this.currentNode = this.plot.options.data;\n        this.currentDepth = 1;\n      } else {\n        this.startNodeName = this.startNode.name;\n        this.currentNode = this.startNode;\n      }\n      this.y = this.view.coordinateBBox.maxY + PADDING_TOP;\n      this.breadcrumb = new Breadcrumb({\n        container: this.container,\n        x: 0,\n        y: this.y,\n        items: this.getItems(),\n      });\n      this.breadcrumb.init();\n      this.breadcrumb.render();\n      this.plot.canvas.draw();\n      this.layout();\n    }\n    this.onInteraction();\n  }\n\n  protected clear() {\n    return;\n  }\n\n  private layout() {\n    const currentWidth = this.container.getBBox().width;\n    const x = (this.plot.width - currentWidth) / 2;\n    this.breadcrumb.update({\n      x,\n      y: this.y,\n    });\n    this.breadcrumb.render();\n  }\n\n  private getItems() {\n    let items = [];\n    if (this.currentNode.name && this.currentNode.name === this.startNodeName) {\n      const rootItem = this.getRootItem();\n      items.push(rootItem);\n    } else {\n      items = [];\n      const parents = [];\n      this.findParent(this.currentNode, parents);\n      items.push(this.getRootItem());\n      each(parents, (p, index) => {\n        items.push({ key: String(index + 2), text: p.name, data: p });\n      });\n      items.push({ key: String(parents.length + 2), text: this.currentNode.name, data: this.currentNode });\n    }\n    return items;\n  }\n\n  private findParent(data, parents) {\n    if (data.parent) {\n      if (hasKey(this.cache, data.parent.name)) {\n        parents.push(this.cache[data.parent.name]);\n      } else {\n        parents.push(data.parent);\n      }\n      this.findParent(data.parent, parents);\n    } else {\n      return;\n    }\n  }\n\n  private onInteraction() {\n    this.container.on('click', (ev) => {\n      const targetParent = ev.target.get('parent');\n      if (targetParent && targetParent.get('class') === 'item-group') {\n        const data = targetParent.get('data');\n        if (data.data) {\n          if (data.text === this.startNodeName) {\n            const targetDepth = 1;\n            //只有前后depth相邻才执行上卷动画，否则直接更新\n            if (this.currentDepth - 1 === targetDepth) {\n              rollingUp(this.currentNode.name, this.view, () => {\n                this.updateRoot(data);\n              });\n            } else {\n              this.updateRoot(data);\n            }\n            this.currentDepth = 1;\n          } else if (this.currentNode === data.data) {\n            return;\n          } else {\n            const previousDepth = clone(this.currentDepth);\n            this.currentDepth = parseInt(data.key);\n            if (previousDepth - 1 === this.currentDepth) {\n              rollingUp(this.currentNode.name, this.view, () => {\n                this.update(data.data);\n              });\n            } else {\n              this.update(data.data);\n            }\n          }\n        }\n      }\n    });\n  }\n\n  private getRootItem() {\n    const rootData = this.plot.options.data;\n    const rootName = hasKey(rootData, 'name') ? rootData.name : 'root';\n    return { key: '1', text: rootName, data: this.plot.rootData };\n  }\n\n  private saveOriginMapping() {\n    const { colorField, colors } = this.plot.options;\n    const mappingInfo = { field: colorField, values: colors };\n    this.originMapping = mappingInfo;\n  }\n\n  private adjustScale(index) {\n    const { view } = this;\n    // 根据当前层级确定mapping配置项\n    if (this.mapping && hasKey(this.mapping, String(index))) {\n      const mappingCfg = clone(this.mapping[index]);\n      if (mappingCfg.values && isFunction(mappingCfg.values)) {\n        const values = mappingCfg.values(this.parentNode, this.currentNode);\n        mappingCfg.values = values;\n      }\n      this.view.geometries[0].color(mappingCfg.field, mappingCfg.values);\n    } else {\n      const mappingCfg = clone(this.originMapping);\n      this.view.geometries[0].color(mappingCfg.field, mappingCfg.values);\n    }\n    view.render();\n  }\n\n  private initGeometry() {\n    this.geometry = this.view.geometries[0];\n    const viewRange = this.view.viewBBox;\n    const container = this.geometry.container;\n    container.setClip({\n      type: 'rect',\n      attrs: {\n        x: viewRange.minX,\n        y: viewRange.minY,\n        width: viewRange.width,\n        height: viewRange.height,\n      },\n    });\n  }\n\n  private updateRoot(data) {\n    this.view.changeData(data.data);\n    this.adjustScale(1);\n    this.currentNode = this.plot.options.data;\n    this.render();\n  }\n}\n\nBaseInteraction.registerInteraction('drilldown', DrillDownInteraction);\n"]}