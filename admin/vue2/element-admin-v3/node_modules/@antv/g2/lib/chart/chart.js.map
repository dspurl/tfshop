{"version":3,"file":"chart.js","sourceRoot":"","sources":["../../src/chart/chart.ts"],"names":[],"mappings":"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","sourcesContent":["import { debounce, each, isString, get } from '@antv/util';\nimport { ChartCfg } from '../interface';\nimport { GROUP_Z_INDEX } from '../constant';\nimport { getEngine } from '../engine';\nimport { createDom, getChartSize, removeDom, modifyCSS } from '../util/dom';\nimport View from './view';\n\n/**\n * Chart 类，是使用 G2 进行绘图的入口。\n */\nexport default class Chart extends View {\n  /** Chart 的 DOM 容器 */\n  public ele: HTMLElement;\n\n  /** 图表宽度 */\n  public width: number;\n  /** 图表高度 */\n  public height: number;\n  /** 是否开启局部刷新 */\n  public localRefresh: boolean;\n  /** 是否自适应 DOM 容器宽高，默认为 false，需要用户手动指定宽高 */\n  public autoFit: boolean;\n  /** 图表渲染引擎 */\n  public renderer: 'canvas' | 'svg';\n\n  private wrapperElement: HTMLElement;\n\n  // @ts-ignore\n  constructor(props: ChartCfg) {\n    const {\n      container,\n      width,\n      height,\n      autoFit = false,\n      padding,\n      appendPadding,\n      renderer = 'canvas',\n      pixelRatio,\n      localRefresh = true,\n      visible = true,\n      defaultInteractions = ['tooltip', 'legend-filter', 'legend-active', 'continuous-filter', 'ellipsis-text'],\n      options,\n      limitInPlot,\n      theme,\n    } = props;\n\n    const ele: HTMLElement = isString(container) ? document.getElementById(container) : container;\n\n    // 生成内部正式绘制的 div 元素\n    const wrapperElement = createDom('<div style=\"position:relative;\"></div>');\n    ele.appendChild(wrapperElement);\n\n    // if autoFit, use the container size, to avoid the graph render twice.\n    const size = getChartSize(ele, autoFit, width, height);\n\n    const G = getEngine(renderer);\n\n    const canvas = new G.Canvas({\n      container: wrapperElement,\n      pixelRatio,\n      localRefresh,\n      ...size,\n    });\n\n    // 调用 view 的创建\n    super({\n      parent: null,\n      canvas,\n      // create 3 group layers for views.\n      backgroundGroup: canvas.addGroup({ zIndex: GROUP_Z_INDEX.BG }),\n      middleGroup: canvas.addGroup({ zIndex: GROUP_Z_INDEX.MID }),\n      foregroundGroup: canvas.addGroup({ zIndex: GROUP_Z_INDEX.FORE }),\n      padding,\n      appendPadding,\n      visible,\n      options,\n      limitInPlot,\n      theme,\n    });\n\n    this.ele = ele;\n    this.canvas = canvas;\n    this.width = size.width;\n    this.height = size.height;\n    this.autoFit = autoFit;\n    this.localRefresh = localRefresh;\n    this.renderer = renderer;\n    this.wrapperElement = wrapperElement;\n\n    // 自适应大小\n    this.updateCanvasStyle();\n    this.bindAutoFit();\n    this.initDefaultInteractions(defaultInteractions);\n  }\n\n  private initDefaultInteractions(interactions) {\n    each(interactions, (interaction) => {\n      this.interaction(interaction);\n    });\n  }\n\n  /**\n   * 改变图表大小，同时重新渲染。\n   * @param width 图表宽度\n   * @param height 图表高度\n   * @returns\n   */\n  public changeSize(width: number, height: number) {\n    // 如果宽高一致，那么 changeSize 不执行任何操作\n    if (this.width === width && this.height === height) {\n      return this;\n    }\n\n    this.width = width;\n    this.height = height;\n    this.canvas.changeSize(width, height);\n\n    // 重新渲染\n    this.render(true);\n\n    return this;\n  }\n\n  /**\n   * 销毁图表，同时解绑事件，销毁创建的 G.Canvas 实例。\n   * @returns void\n   */\n  public destroy() {\n    super.destroy();\n\n    this.unbindAutoFit();\n    this.canvas.destroy();\n\n    removeDom(this.wrapperElement);\n    this.wrapperElement = null;\n  }\n\n  /**\n   * 显示或隐藏图表\n   * @param visible 是否可见，true 表示显示，false 表示隐藏\n   * @returns\n   */\n  public changeVisible(visible: boolean) {\n    super.changeVisible(visible); // 需要更新 visible 变量\n    this.wrapperElement.style.display = visible ? '' : 'none';\n\n    return this;\n  }\n\n  /**\n   * 自动根据容器大小 resize 画布\n   */\n  public forceFit() {\n    // skip if already destroyed\n    if (!this.destroyed) {\n      // 注意第二参数用 true，意思是即时 autoFit = false，forceFit() 调用之后一样是适配容器\n      const { width, height } = getChartSize(this.ele, true, this.width, this.height);\n      this.changeSize(width, height);\n    }\n  }\n\n  private updateCanvasStyle() {\n    modifyCSS(this.canvas.get('el'), {\n      display: 'inline-block',\n      verticalAlign: 'middle',\n    });\n  }\n\n  private bindAutoFit() {\n    if (this.autoFit) {\n      window.addEventListener('resize', this.onResize);\n    }\n  }\n\n  private unbindAutoFit() {\n    if (this.autoFit) {\n      window.removeEventListener('resize', this.onResize);\n    }\n  }\n\n  /**\n   * when container size changed, change chart size props, and re-render.\n   */\n  private onResize = debounce(() => {\n    this.forceFit();\n  }, 300);\n}\n"]}